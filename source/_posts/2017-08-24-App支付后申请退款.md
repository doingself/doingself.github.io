
---
title: App支付后申请退款
date: 2017-08-24 10:38:55
categories:
  - Java
tags:
  - 退款
description: "手机App 支付宝、微信 支付后，请求退款"
copyright: true
---


手机付款成功后，请求退款

后台服务端使用 Java开发

# 支付宝 退款

参考：https://docs.open.alipay.com/api_1/alipay.trade.refund

```
/// 支付宝退款
public boolean alipayRefunds(Map<String, String> params){

    /*
out_trade_no	String	特殊可选	64	订单支付时传入的商户订单号,不能和 trade_no同时为空。	20150320010101001
trade_no	String	特殊可选	64	支付宝交易号，和商户订单号不能同时为空	2014112611001004680073956707
refund_amount	Price	必选	9	需要退款的金额，该金额不能大于订单金额,单位为元，支持两位小数	200.12
refund_reason	String	可选	256	退款的原因说明	正常退款
out_request_no	String	可选	64	标识一次退款请求，同一笔交易多次退款需要保证唯一，如需部分退款，则此参数必传。	HZ01RF001
operator_id	String	可选	30	商户的操作员编号	OP001
store_id	String	可选	32	商户的门店编号	NJ_S_001
terminal_id	String	可选	32	商户的终端编号	NJ_T_001
    */
    AlipayTradeRefundModel refundModel = new AlipayTradeRefundModel();
    refundModel.setOutTradeNo(params.get("out_trade_no"));
    refundModel.setRefundAmount(params.get("total_fee"));
    refundModel.setRefundReason(params.get("reason"));
    refundModel.setOutRequestNo(params.get("request_no"));
    String jsonStr = JSON.toJSONString(refundModel);

    String APP_ID = params.get("seller_id");
    String CHARSET = params.get("_input_charset");
    String APP_PRIVATE_KEY = params.get("key");
    String ALIPAY_PUBLIC_KEY = params.get("publicKey");

    //实例化客户端
    AlipayClient alipayClient = new DefaultAlipayClient("https://openapi.alipay.com/gateway.do", APP_ID, APP_PRIVATE_KEY, "json", CHARSET, ALIPAY_PUBLIC_KEY, "RSA2");

    AlipayTradeRefundRequest request = new AlipayTradeRefundRequest();
    request.setBizContent(jsonStr);

    try {
        AlipayTradeRefundResponse response = alipayClient.execute(request);
        if(response.isSuccess()) {
            // 调用成功
            return true;
        }else{
        	// 支付宝退款失败
        	// response.getSubMsg();
            return false;
        }
    } catch (AlipayApiException e) {
        e.printStackTrace();
        // 支付宝退款失败，请联系管理员
        return false;
    }
}
```


# 微信 退款

